<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title>The journey of a Bigtable migration</title><meta charset="UTF-8"></meta><meta name="generator" content="Hovercraft! 1.0 http://regebro.github.com/hovercraft"></meta><meta name="keywords" content="bigtable, gcp"></meta><link rel="stylesheet" href="css/hovercraft.css" media="all"></link><link rel="stylesheet" href="css/highlight.css" media="all"></link><link rel="stylesheet" href="./css/main.css" media="screen,projection"></link><script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        showProcessingMessages: false,
        messageStyle: "none",
        TeX : { extensions : ['color.js'] }
      });
    </script></head><body class="impress-not-supported"><div id="impress"><div class="step step-level-1" step="0" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="0" data-y="0" data-z="0"><h1 id="the-journey-of-a-bigtable-migration">The journey of a Bigtable migration</h1></div><div class="step step-level-1" step="1" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="1600" data-y="0" data-z="0"><h1 id="agenda">Agenda</h1><ul><li>Project Overview</li><li>Why Bigtable?</li><li>Design &amp; Planning</li><li>Implementation Experience</li><li>Lessons Learned</li><li>Conclusion</li><li>Q&amp;A</li></ul></div><div class="step step-level-1" step="2" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="3200" data-y="0" data-z="0"><h1 id="problem-overview">Problem Overview</h1><p><strong>Critical component:</strong></p><ul><li>high demand and workload</li><li>critical performance</li></ul><img src="./img/component_diagram.webp" width="400px"></img></div><div class="step step-level-1" step="3" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="4800" data-y="0" data-z="0"><h1 id="problem-overview-1">Problem Overview</h1><p><strong>Limitations of the Previous Database:</strong></p><ul><li>performance on high workload spikes</li></ul><img src="./img/bad_performance.webp" width="400px"></img></div><div class="step step-level-1" step="4" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="6400" data-y="0" data-z="0"><h1 id="why-bigtable">Why Bigtable?</h1><ul><li>workload support</li><li>service documentation(*)</li><li>datacenter distribution</li><li>terraform integration</li></ul><img src="./img/bigtable_logo.webp" width="400px"></img></div><div class="step step-level-1" step="5" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="8000" data-y="0" data-z="0"><h1 id="design-planning">Design &amp; Planning</h1><p><strong>Migration Planning:</strong></p><ul><li>Infrastructure/scalability</li><li>Schemas re-design</li><li>Software integration</li><li>Maintainance planning</li></ul><img src="./img/planning.webp" width="400px"></img></div><div class="step step-level-1" step="6" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="9600" data-y="0" data-z="0"><h1 id="infrastructure-scalability">Infrastructure &amp; Scalability</h1><p><strong>To figure out:</strong></p><ul><li>Cluster: when, how many</li><li>Nodes: max/min, rescale criteria</li><li>Data management policies</li><li>IAM roles and permissions</li></ul><img src="./img/bigtable_structure.webp" width="600px"></img><div class="notes"><p>in terraform talk about multiple-provider to create instances with different zone</p></div></div><div class="step step-level-1" step="7" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="11200" data-y="0" data-z="0"><h1 id="schemas-re-design">Schemas re-design</h1><p><strong>Data structure oriented to query</strong></p><pre class="highlight code python"><span class="p">{</span><span class="w">
</span><span class="s2">"created_at"</span><span class="p">:</span> <span class="s2">"2024-06-10T15:40:00ZGMT-5"</span><span class="p">,</span>  <span class="c1">#--- IS THIS STILL REQUIRED?</span><span class="w">
</span><span class="s2">"dog"</span><span class="p">:</span> <span class="p">{</span>             <span class="c1">#--- THIS COULD BE A COLUMN GROUP PET</span><span class="w">
</span>    <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"Buddy"</span><span class="p">,</span><span class="w">
</span>    <span class="s2">"breed"</span><span class="p">:</span> <span class="s2">"Golden Retriever"</span><span class="p">,</span><span class="w">
</span>    <span class="s2">"age"</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span><span class="w">
</span>    <span class="s2">"weight"</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span><span class="w">
</span>    <span class="s2">"vaccinations"</span><span class="p">:</span> <span class="p">[</span><span class="w">
</span>    <span class="s2">"Rabies"</span><span class="p">,</span><span class="w">
</span>    <span class="p">]</span><span class="w">
</span><span class="p">},</span><span class="w">
</span><span class="s2">"hiking_session"</span><span class="p">:</span> <span class="p">{</span> <span class="c1">#--- THIS COULD BE A COLUMN GROUP EXERCISE</span><span class="w">
</span>    <span class="s2">"date"</span><span class="p">:</span> <span class="s2">"2024-07-12"</span><span class="p">,</span><span class="w">
</span>    <span class="s2">"location"</span><span class="p">:</span> <span class="s2">"Blue Mountain Trail"</span><span class="p">,</span><span class="w">
</span>    <span class="s2">"distance_km"</span><span class="p">:</span> <span class="mf">5.6</span><span class="p">,</span><span class="w">
</span>    <span class="s2">"duration_hours"</span><span class="p">:</span> <span class="mf">2.5</span><span class="p">,</span><span class="w">
</span>    <span class="s2">"participants"</span><span class="p">:</span> <span class="p">[</span><span class="w">
</span>    <span class="s2">"John Doe"</span><span class="p">,</span><span class="w">
</span>    <span class="s2">"Buddy"</span><span class="w">
</span>    <span class="p">],</span><span class="w">
</span>    <span class="s2">"weather"</span><span class="p">:</span> <span class="p">{</span><span class="w">
</span>    <span class="s2">"temperature_celsius"</span><span class="p">:</span> <span class="mi">22</span><span class="p">,</span><span class="w">
</span>    <span class="s2">"conditions"</span><span class="p">:</span> <span class="s2">"Sunny"</span><span class="w">
</span>    <span class="p">},</span><span class="w">
</span>    <span class="s2">"notes"</span><span class="p">:</span> <span class="s2">"Buddy enjoyed the hike and showed great energy throughout the session."</span><span class="w">
</span><span class="p">},</span><span class="w">
</span><span class="s2">"wash_session"</span><span class="p">:</span> <span class="p">{</span> <span class="c1"># THIS COULD BE A COLUMN GROUP CLEANING</span><span class="w">
</span>    <span class="s2">"date"</span><span class="p">:</span> <span class="s2">"2024-07-13"</span><span class="p">,</span><span class="w">
</span>    <span class="s2">"location"</span><span class="p">:</span> <span class="s2">"Pet Grooming Salon"</span><span class="p">,</span><span class="w">
</span>    <span class="s2">"duration_minutes"</span><span class="p">:</span> <span class="mi">45</span><span class="p">,</span><span class="w">
</span>    <span class="s2">"services"</span><span class="p">:</span> <span class="p">[</span><span class="w">
</span>    <span class="s2">"Shampoo"</span><span class="p">,</span><span class="w">
</span>    <span class="s2">"Nail Clipping"</span><span class="p">,</span><span class="w">
</span>    <span class="s2">"Ear Cleaning"</span><span class="w">
</span>    <span class="p">],</span><span class="w">
</span>    <span class="s2">"groomer"</span><span class="p">:</span> <span class="s2">"Alice Johnson"</span><span class="p">,</span><span class="w">
</span>    <span class="s2">"notes"</span><span class="p">:</span> <span class="s2">"Buddy was calm during the wash and grooming session."</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="p">}</span></pre></div><div class="step step-level-1" step="8" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="12800" data-y="0" data-z="0"><h1 id="schemas-re-design-1">Schemas re-design</h1><p><strong>Migration Steps:</strong></p><ul><li>Process of migrating data</li><li>Handling challenges (data inconsistencies, integrity)</li><li>Data migration (Canary deploy)</li></ul><img src="./img/db_migration.webp" width="400px"></img></div><div class="step step-level-1" step="9" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="14400" data-y="0" data-z="0"><h1 id="software-integration">Software Integration</h1><p><strong>Adapting Existing Services:</strong></p><ul><li>New db driver</li><li>Support Sync / Async</li></ul><img src="./img/adapt_design.webp" width="400px"></img></div><div class="step step-level-1" step="10" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="16000" data-y="0" data-z="0"><h1 id="software-integration-1">Software Integration</h1><p><strong>Performance Testing:</strong></p><ul><li>Post-migration performance testing and optimization</li></ul><img src="./img/tweak.webp" width="400px"></img></div><div class="step step-level-1" step="11" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="17600" data-y="0" data-z="0"><h1 id="maintainance-planning">Maintainance planning</h1><ul><li>Backups
- Autobackup(*)
- Custom Legacy Backup</li><li>Monitoring (service-side)</li></ul><img src="./img/backup.webp" width="400px"></img></div><div class="step step-level-1" step="12" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="19200" data-y="0" data-z="0"><h1 id="things-we-learned">Things we learned</h1><table cellpadding="0" cellspacing="0"><thead><tr><th><p>"Problem"</p></th><th><p>"How to deal it"</p></th></tr></thead><tbody><tr><td><p>Bad python documentation</p></td><td><p>"Read source code + service docs</p></td></tr><tr><td><p>Sync client performance</p></td><td><p>"Dedicated IO loop to handle async grpc for sync environments</p></td></tr><tr><td><p>Backup</p></td><td><p>"Autobackup + lifespan management</p></td></tr></tbody></table></div><div class="step step-level-1" step="13" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="20800" data-y="0" data-z="0"><h1 id="conclusion">Conclusion</h1><p><strong>Summary:</strong>
- Recap of the journey</p><p><strong>Final Thoughts:</strong>
- Encouragement for teams to consider Bigtable</p></div><div class="step step-level-1" step="14" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="22400" data-y="0" data-z="0"><h1 id="q-a">Q&amp;A</h1><img src="./img/QA.webp" width="650px"></img></div></div><div class="footer"><p>Google Extended I/O Cali 2024</p></div><script type="text/javascript" src="js/impress.js"></script><script type="text/javascript" src="js/gotoSlide.js"></script><script type="text/javascript" src="js/hovercraft.js"></script></body></html>